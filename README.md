WB-Starter
==========

My personal framework for front-end development includes some SASS, HTML, and JS snippits that I use on a regular basis. This framework is built using NPM and Gulp and it is meant to be pulled apart or modified for the project at hand. By changing settings in the `package.json` file, this can be used for one-page landing pages, as well as used in full-fledged CMS themes.

This is here for my own storage, but please let me know if you have any feedback or suggestions.

## Installation
NOTE: these instructions are for a Mac. Commands for PC or Linux might be slightly different.

### Setting Up for the First Time
1. Clone the repo into your site's root folder. You may move your `_source` and `_build` folders if needed
2. Install [Node](http://nodejs.org/) (requires v7+)
3. Make sure Ruby is installed, then install [SASS](http://sass-lang.com/) by running the command `gem install sass`
4. If you don't have Homebrew, you can install it using this command: `ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"`
5. Install ImageMagick, run this command: `brew install imagemagick`
6. Run `npm install -g gulp-cli`.
7. Go to your site's root folder and run the command: `yarn`. This will do the same thing as `npm install`, but faster. If you don't have yarn installed, globally, run `npm install --global yarn`

### Setting Up Each Project
1. In Terminal, `cd` to your project root
2. Run `yarn`
3. Update the `package.json` file to fit your project's needs. See `package.json` below
4. Run `npm run setup` to perform the default task and to do an initial setup

---
## When to Use What
### Beginning a project
- When starting a project, run the helper task, `npm run list`, to see what commands are available.
- `npm run setup` should be run at the beginning of the project to pull together template files based on the type of project your are developing. In this task, you will be prompted to answer some questions that will customize the components and templates added to your `_source` folder. *NOTE: because this task overrides files in your `_source` folder, it should only be run once, at the beginning of a project.*
- `gulp font` can be run anytime you'd like when you need to add fonts to your project. See Using Fonts in CSS, below for configuration options.
- To make sure everything is working right, finish setting up your theme files and your `package.json` settings and run the `npm run dev` task. This will give you a good idea of any errors you might run into right off the bat. Even better, run `npm run prod` for a more thorough check.

### During Development
- Every time you begin to write code, run `npm run watch` first. This will watch the `_source` folder and update theme files as you save them.
- At any given time, run `npm run dev` to reprocess basic theme assets (JS, CSS, and images). Doing this will clean out old JS, CSS, and image files and replace them with up-to-date versions.

### Staging and Testing
- When staging files for review or testing, run `npm run prod`—every time—before deploying to a staging server. `npm run prod` includes extra tasks, such as Babel transpiling and uglification of Javascript files. While these may not be needed for better performance on a staging server, these tasks might slightly change the code enough to cause bugs to appear.

### Going Live
- When preparing to go live, run the `npm run prod` task. This will increase the version number in the `package.json` file, which will cause cache-busting to occur on static files that are loaded using version number parameters.
- Running `npm run prod` cleans out all CSS, JS, SVG, and image files and replaces them with fresh builds.
- `npm run prod` also creates favicons, adds Critical CSS, processes SVG icons and processes template files.

---
## Theme Components
### SCSS Framework
- In `_source/scss` there are a several files with underscores in front. These all get compiled into `app.css`, by default.
- Sass will compile all `.scss` files that do note contain an underscore in front of the filename.
- Files are organized into folders:
  - `automated` – For files generated by Gulp. We can assume these will update on their own, so we wouldn’t edit these manually.
  - `base` – Global CSS that is used across all pages of the site. Animations, variables, mixins, and global styles are all organized here so they’re in one place.
  - `compontents` – base CSS for HTML components, such as forms, buttons, tables, images, etc… These should be abstracted and modular so these elements can be dropped anywhere in the site and still look the same.
  - `layout` – Layout areas and re-usable sections get styled here (as opposed to putting styles for these in the `base/_globals.scss`). Other layout elements can be added by just adding another .scss file here. It will automatically get compiled just by being in the folder.
  - `lib` – For any CSS that we receive from vendors (like our clients) can go here. These should not be edited by us, so it can be assumed than any file here can be updated at any time.
  - `pages` – Code specific to a particular page. If code is part of a re-usable component (like a “Meet the Team” layout that can be used on several pages), it should go in `layout`, but if it’s only used on one page (like code specific to the “Homepage”), it should go here.’
- CSS follows the [BEM naming convention](http://getbem.com/naming/) to reduce accidental mixing of styles.
- Elements with class names that are prefixed with `c_` indicate this is a CSS component that is part of the Style Inventory.

#### Using Fonts in CSS
- A `font()` mixin is available to optimize the use of custom `@font-face` fonts, and to making changes to fonts and font stacks consistent in your CSS. Here are the advantages of using this mixin:
  - Only fonts that are used within your SCSS are given a `@font-face` declaration.
  - `@font-face` declarations are only made once, on the first time that `font()` appears in SCSS. This reduces the amount of CSS code.

In your `package.json`, here are the options you can use. Options marked with ° are required:
  - °`name` – Used to identify the font when using the `font()` mixin. For example, in your SCSS you could write `@include font('avinir');`.
  - °`source` – Determines whether or not a font needs a `@font-face` declaration. Options are `system` or `fontface`.
  - °`fontFamily` – The font family used in CSS to refer to the font. If quotes are needed, use single quotes. For example: `"fontFamily": "'Avinir Next'",`
  - °`fallbackStack` – Fallbacks used in order in case the font is not loaded.
  - °`fontStyle` – CSS value for the `font-style` property. The output in CSS will be `font-style: normal;`, by default.
  - °`fontWeight` – CSS value for the `font-weight` property. The output in CSS will be `font-weight: normal;`, by default. You can use any CSS-valid value, such as `100` or `bold`.
  - `files` – Pairs up font file types and their locations. This is only applicable for fonts that need a `@font-face` declaration. In most situations, you'll want an `.eot` and a `.woff` file for cross-browser compatibility. A `.woff2` file can be included for better performance.



---
### Javascript
- All of the JS is configured to be compiled using [Webpack](https://webpack.js.org/) and then loaded using [loadJS](https://github.com/filamentgroup/loadJS).

#### Using Webpack
For Javascript files, Webpack is used to uglify, transpile and concatenate our files into bundles. It pulls directly from `_source/_js/` and `node_modules` and creates single Javascript files in `public/js/`.

Currently, there is one file, `app.js`, but if you need to split out code into additional bundles, you can configure Webpack in the `webpack.config.js` file. To add another Javascript file, modify the `entry` object:

```
entry: {
    app: paths.srcJs + "app.js",
},
```

Adding a line to `entry` requires that you give it a name (as the key), and point to the source file. Whatever you name the key will become the name of the bundle when it is created in `public/js/`.

When `npm run prod` is run, Webpack will know it is preparing files for release, so it will uglify your code within `plugins`.

```
plugins: (env === 'production') ? [
    new UglifyJsPlugin({
        sourceMap: true
    })
] : [],
```

You can add more plugins here, if you'd like.

### lazy.js
Include `lazy.js` into a JS document and call the default, `lazy()` function to init. An optional `config` object can be passed into the `lazy()` function.

```javascript
import lazy from 'lazy';

const config = {
    animationFunctions: {
        'fadePageBgColor': fadePageBgColor,
    }
};

lazy(config);
```

#### Lazy Loading
To use Lazy Loading for better loading performance, add the `data-lazy-load` attribute to an element. By itself, this will do nothing, but when combined with the optional attributes, below, different modifications will be made to the element.

| Attribute | Example Value | Description |
| --- | --- | --- |
| `data-src` | `/img/FPO.png` | Changes to the `src` attribute for `<video>`, `<audio>`, and `<img>` tags. |
| `data-srcset` | `/img/FPO.png 1x, /img/FPO@2x.png 2x` | Changes to the `srcset` tag uses in `<img>` tags. |
| `data-width` | `2048` | Setting both `data-width` and `data-height` on an element will add inline styles to the element that allow it to proportionately take up as much room as an image would in that space. This can be used for placeholder images styled in CSS. |
| `data-height` | `2048` |  |
| `data-bg-array` | See below | Uses a JSON string to generate CSS in a `<style>` tag below the element that populates the element's `background-image` property. |

The value of `data-bg-array` is converted from a string into a JSON object. Here's an example JSON string:
`{ "class": "image_2", "css": [{ "url": "/img/FPO.jpg", "extra": "background-position: 50% 50%;"" },{ "retina": true, "url": "/img/FPO@2x.jpg" },{ "mq": "(min-width: 700px)", "url": "/img/FPO.png" },{ "mq": "(min-width: 700px)", "retina": true, "url": "/img/FPO@2x.png" }] }`

In this example, here are a few things to note:
 - `class`
   - Adds a class to your element that is used as the CSS selector in the generated CSS. This should be unique so that the class can be selected on it's own. One way to make this unique is to pass in a `{{ block.id }}` or `{{ image.id }}` (in Craft), or make a unique class name that's descriptive of the use of the image element.
 - `css`
   - An array of properties that build out the CSS.
   - This array is looped in order, so it will cascade in the order of each object in the array.
   - `url`
     - The URL of the background image.
   - `extra`
     - Any extra CSS that needs to be included or overridden for this object. Useful for using `{{ image.focalPoint }}` (in Craft) to set the `background-position` property.
   - `retina`
     - Includes a check for 2x pixel density in the media query wrapping the CSS.
   - `mq`
     - A media query that wraps the CSS generated for this image. Can be combined with `retina` to also require that the screen resolution is at least 2x.

#### On-scroll Animations
When used with no value, `data-lazy-animate` simply adds the class `animated` to an element. In your CSS, a transition or CSS animation can fire when `animated` is added. You can also register a function that can be fired by setting the name of the function to the value of `data-lazy-animate`.

| Attribute | Example Value | Description |
| --- | --- | --- |
| `data-lazy-animate` | **NONE** or `myFunction` | When the user scrolls to the element, a function registered in `config.animationFunctions` (see example above), will be fired. |
| `data-lazy-animate-args` | `{ "id": 23, "option": "value" }` | Arguments that will be passed into the function registered in `data-lazy-animate` as an object. |
| `data-lazy-animate-exit` | `myExitFunction` | When the element scrolls out of the viewport, a function registerd in `config.animationFunctions` will be fired. |
| `data-lazy-animate-args-exit` | `{ "option": "value" }` | Arguments for the function in the `data-lazy-animate-exit` attribute. |
| `data-lazy-animate-delay` | `500` | Uses `setTimeOut()` to delay the firing of a function set in `data-lazy-animate`. |
| `data-lazy-animate-offset` | `-200` | Used to determine how much outside or inside an element needs to be within the viewport before activating. |
| `data-lazy-animate-reset` | **NONE** | Add this attribute to allow a JS animation to continue firing as the element re-enters the viewport. |

### scrollto.js
Include `scrollto.js` into a JS document and call the default, `scrollto()` function to init.

```javascript
import scrollto from 'scrollto';

function scrollToElement(el) {
    const elRect = el.getBoundingClientRect();
    const newY = elRect.top + document.body.scrollTop - 130;

    scrollto({ destination: newY });
}

const el = document.getElementById("section_1");
scrollToElement(el);
```

| Attribute | Default | Description |
| --- | --- | --- |
| `destination` | 0 | A `scrollTop` position, based on the top of the document. Leave this at `0` to go back to the top of the document. |
| `duration` | 500 | How long the animation shold take. |
| `easing` | 'easeOutQuad' | Easing function used to determine how the animation will look. Look into the `scroll.js` file to see what options are available. |
| `callback` | *undefined* | Pass in a callback function that should fire after animation is done. |

---
### Image Processing
- **_img** Images will be processed differently depending on where they are located in the `_source/_img` folder:
  - **2x** Putting 2x-resolution images in the `2x` folder will result in both a 2x image and a 1x image being placed into your `img` directory. The 2x image will be suffixed with `@2x`.
  - **icons** All .svg images in the `icons` folder will be base64-encoded and added using `background-image` to a file in the `_source/sass/automated/` folder, called `_icons.scss`. This will be compiled when the `sass` task is run. A file, named `logo.svg` will access using the class, `.icon_logo`.
  - Images located directly in the `_source/_img`, or folders not listed above will only be minimized and moved into your theme's `img` folder.
- **_favicons** Adding a 512x512 .png into the `_source/_favicons` folder, and running `npm run prod`, will result in a set of meta images placed in `img/meta`. HTML for these images will be generated in `_build/html/meta.html`. This code will be included as part of the HTML build process.

---
### Gulp HTML Builder
- Uses [ejs](http://ejs.co) to process HTML files when the `npm run prod` task is run.
- Using `ejs` allows you to include files, use conditionals, and replace strings—like IDs and classes.
- There are default replacements included in the Gulpfile, and additional replacements can be added to the `ejsVars` setting in `package.json`. If the replacement is for an include, the file must be included based on the root of the `_build` folder.

---
## Release Notes
#### 4.9.0
- :rocket: Added NPM scripts to replace Gulp commands
  - Use the following replacements when needed:
    - `npm run dev`: replaces `gulp run`
    - `npm run prod`: replaces `gulp release`
    - `npm run watch`: replaces `gulp watch`
    - `npm run list`: replaces `gulp`
  - Other commands can still be run, but using NPM scripts for standard commands allows us to run non-gulp commands, as well
  - Suggested aliases to make typing easier:
  
  ```
  alias dev="npm run dev"
  alias list="npm run list"
  alias prod="npm run prod"
  alias watch="npm run watch"
  ```
- :rocket: Replaced SystemJS with Webpack
  - Module loading via `import` statements at the top of your Javascript file
    - For NPM packages, you can refer to it by name (for example, `css-loader`)
    - For custom libraries, import using a relative path (for example, `./lazy.js`)
  - Webpack runs on `npm run dev`, `npm run prod`, and `npm run watch`
  - Removed SystemJS code from templates
  - Removed path settings in `_head_scripts.ejs`
- :rocket: Converted Vue components in `vue-components.js` to Single File Components
  - Uses scoped SCSS for easier CSS defaults
  - SCSS imports `_source/_scss/base/mixins.scss` so variables can be used
  - A "Hello, World" component is available as a skeleton for future components
- :rocket: Added `webkit.config.js`
  - Javascript files get compiled according to Webpack configuration
  - Other Webpack plugins and configurations can be added
- :rocket: Added `loadJS` for JS loading – Welcome back :tada:
  - Loading uses filename of set in the `jsSection` variable in `head_scripts`
- :rocket: Added new folder for Craft 3 templates, but it's only a copy of Craft 2 for now
- :rocket: Added new `template_directory` variable to `package.json` in case template, specific EJS code is desired
- :wrench: Changed `home.js` to `app.js` and removed `inside.js`
  - Most sites don't need page specific js bundles, but if you need to split code into several files, save a new Javascript file and configure webpack to handle it
- :wrench: Changed `_source/_sass` to `_source/_scss`
- :wrench: Changed filename from `all.css` to `app.css`
- :wrench: Moved filepaths for `loadCSS` and `loadJS` from `Gulpfile.js` to `package.json` so they can be updated if needed
- :fire: Removed `body_bottom_scripts.ejs`
- :fire: Removed `gulp first` and related tasks
- :fire: Removed tasks that moved files from `node_modules`
  - Use webpack or relative paths to include libraries directly from `node_modules`

#### 4.8.1
- :rocket: Added the ability to show arguments accepted by components in Style Inventories
  - Add an `options` array into a style inventory to show argument names, required or not, type, default value, and a description
  - Look at `_source/_util/_craft2_1/templates/_html/dev/_style_inv/buttons.twig` for an example of the `options` array
  - More will be added later
- :fire: Removed Ideal Image Slider from `package.json` and other associated files

#### 4.8.0
- :rocket: Added `gulp setup` task
- :wrench: Refactored `_source/_util` folder to make editing Style Inventories easier
- :wrench: Moved everything from `_source/_js/system-config.js` to `_source/_html/ejs_includes/_body_bottom_scripts.ejs` or `_source/_html/ejs_includes/_head_scripts.ejs`
- :fire: Removed `gulp template` task
- :fire: Removed `importPageSpecificModule` function
- :fire: Deleted `_source/_js/system-config.js`
- :fire: Deleted `_source/_js/modernizr.custom.js`
- :fire: Stopped adding `.min` to uglified JS files

#### 4.7.1
- :wrench: Updated all NPM libraries. **This now requires the latest Node 7.x and all `node_modules` should be deleted and `yarn` (or `npm install`) should be run to update dependencies.**
- :wrench: Split index.html into ejs partials for better portability when creating multiple pages
- :rocket: Added an `index` section to default style inventory to explain what a style inventory does
- :wrench: Bug fixes and minor tweaks in `Gulpfile.js`

#### 4.7.0
- :rocket: Added new templates to the default style inventory
  - **Animations** - Added the option to use javascript functions when an element is scrolled into view
    - A function must be passed into the defaul `lazy()` function. Follow the example in `_source/_js/global.js`
    - Add `data-lazy-animate="animationFunction"` to call a function registered as `animationFunction`
    - Adding a pipe after the function name allows you to pass in arguments as a string. For example, `data-lazy-animate="animationFunction|Function Argument"`
  - **CSS Grid** - Added a default "Holy Grail" grid layout
  - **Icons** - Added default Social Media icons
  - **Images** - Added lazy-loading for content images and background images
  - **Media** - Added lazy-loading audio, iframe, and video files
  - **Messages** - Added styles for default messages, used to convey info upon user interaction. Added default "Alert Bar" markup and styles
  - **Naviagtion** - Added example of typical hamburger functionality
  - **Vue Components** - Added accordion and overlay Vue components
- :rocket: Added default function for toggling an `active` class on elements
  - To toggle an `active` class on click on an element, add the attribute `data-active-toggle`
  - To toggle an `active` class on another element, add a CSS selector to the vaulue of the `data-active-toggle` attrbiute. For example, `data-active-toggle="#mobile_nav"`
- :rocket: Added `_source/layout/_grid.scss` for all CSS Grid styles
- :rocket: Added `_source/modules/_messages.scss` to style alert messages
- :rocket: Added `_source/modules/_vue.scss` to style vue components
- :rocket: Added `_js/vue-compontents.js` to add Vue components, an event handler, and to create a root Vue Instance on the `#page` element
- :wrench: Improved style inventory styles

#### 4.5.1
- :rocket: `jsDevMode` now gets set to false when running `npm run prod`
- :rocket: `jsVersion` gets set to the package version number upon `npm run prod`, otherwise it is set to the current timestamp and files that use `<%= version %>` will be forced to reload during development
- :wrench: Added support for `.min` files in the `_js/_lib` folder
  - `.min.js` files do not get uglified or renamed. They are just moved to your `js/_lib` folder in your theme path
- :wrench: Moved SystemJS `<script>` tag, system config code, and font events code down to bottom of the `<body>` tag. I'm not sure if this will have an impact either way, but it seems like it's safe to move to speed up loading
- :rocket: Added `vue.js` to default libraries
  - Vue is not turned on by default, but it'll be there in case you'd like to use it
  - Because of the way Vue's libraries are named (dev = `.js`, prod = `.min.js`), moving only one file during `gulp first` gets messed up, so conditional loading—based on whether or not `jsDevMode` is true—makes it so development Vue is loaded via their CDN, and when `npm run prod` is run, the local, production version is used

#### 4.5.0
- :wrench: Replaced `emergence` with `scrollMonitor` for lazy loading
- :rocket: Added `_source/_js/lazy.js` to handle lazy loading
  - `lazy.js` relies on `data` attributes. See comments in the code for required attributes and data types
  - Check `lazy.js` comments for more information
- :fire: Removed webshot from `Gulpfile.js`
  
#### 4.4.0
- :rocket: Added font configuration settings to `package.json`
- :rocket: Added `gulp font` task to automate `@font-face` declarations and performance enhancements in `_source/automated/_fonts.scss`
  - Configure font settings in `package.json` and run `gulp font` anytime you update fonts you want available in the `font()` mixin
- :rocket: Added style template settings to `package.json`
- :rocket: Added files to create default style inventory sections
  - To add a style inventory section to a page, use `<%- include(styletemplate____) %>` and replace blank with name of the section. For example, to embed the icons section, use `<%- include(styletemplateicons) %>`

#### 4.3.0
- :rocket: Added `browserSync` settings to `package.json`
- :rocket: Added Browsersync support
  - Run `gulp watch` and Browsersync will open a new tab at the URL you set
  - When you save any HTML or Javascript file that is watched, Browsersync will reload the page
  - Saving a SCSS file will automatically update the CSS on the page without reloading

#### 4.2.0
- :wrench: Replaced `RequireJS` with `SystemJS` for Javascript module loading

#### 4.1.0
- :wrench: Removed bower to use npm for front-end libraries